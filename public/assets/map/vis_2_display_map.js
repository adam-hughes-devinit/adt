((function(){var a,b,c,d,e,f,g,h,i;i=window.vis_config,b=function(){var a,b,c,d,e,f;return d=[],$("#oda_like_input option:selected").each(function(a){var b;b=$(this).text();if(b.indexOf("All")!==0)return d.push(b)}),f=[],$("#verified_input option:selected").each(function(a){var b;b=$(this).text();if(b.indexOf("All")!==0)return f.push(b)}),e=[],$("#sector_input option:selected").each(function(a){var b;b=$(this).text();if(b.indexOf("All")!==0)return e.push(b)}),b=[],$("#flow_type_input option:selected").each(function(a){var c;c=$(this).text();if(c.indexOf("All")!==0)return b.push(c)}),a=[],$("#year_input option:selected").each(function(b){var c;c=$(this).text();if(c.indexOf("All")!==0)return a.push(c)}),c={},d.length>0&&(c.flow_class=d),f.length>0&&(c.verified=f),e.length>0&&(c.crs_sector_name=e),b.length>0&&(c.flow_type=b),(a!=null?a.length:void 0)>0&&(c.year=a,i.years=a),delete window.active_params.recipient_iso2,delete window.active_params.get,c!==this.active_params?c:null},f=function(b){var c;return $(".overlay").remove(),typeof b=="string"?$.get("/aggregates/projects?get=recipient_iso2&multiple_recipients=percent_then_merge"+b,a,"json"):(c=b!=null?b:{},c.get="recipient_iso2",c.multiple_recipients="percent_then_merge",$.get("/aggregates/projects",c,a,"json"))},a=function(a){var b,c;return c=75,b=5,window.map_data.forEach(function(b,c){var d;return(d=a.filter(function(a){return a.recipient_iso2===b.key})[0])?(b.values.value=d.usd_2009,b.values.value_current=d.usd_current):(b.values.value=null,b.values.value_current=null)}),window.vis_config.c.domain([0,d3.max(window.map_data,function(a){return Number(a.values.value)})/4,d3.max(window.map_data,function(a){return Number(a.values.value)})*1.1]),window.map_data.forEach(function(a,d){var e,f;return f=d3.select("#"+a.key),a.values.value===null?e="#777":e=window.vis_config.c(a.values.value),f.transition().duration(c).delay(d*b).attr("fill",e)}),window.total_amount_in_view=d3.sum(window.map_data,function(a){return a.values.value}),g(b*window.map_data.length+c,c),e()},e=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;return m=window.vis_config.w,d=window.vis_config.h,c=window.vis_config.c,h=.0225*m,g=2,l=.1*d,b=.025*d,i=10,k=l+b*3,a=c.domain(),j=Math.max(a[2],1e6),f=[j/10,j/5,j/2,j*1.1],d3.selectAll(".legend_bar, .legend_text").transition().duration(400).style("font-size","0px").attr("width","0px").remove(),e=d3.select("#africa-map").selectAll("#id").data([f]).enter().append("g").attr("id","legend").attr("transform","translate("+m/12+","+.6875*d+")"),e.selectAll(".legend_bar").data(Object).enter().append("rect").attr("x","0").attr("y",function(a,c){return k-c*b}).attr("height",h).attr("width","0px").attr("fill",function(a){return c(a)}).attr("class","legend_bar").transition().duration(800).attr("width",function(a,b){return""+(b/4*100+50)+"px"}),e.selectAll(".legend_text").data(Object).enter().append("text").attr("x","5px").attr("y",function(a,c){return 2+i+k-c*b}).style("font-size",i).attr("fill",function(a,b){return""+window.vis_config.grayscalec(b)}).text(function(a){return"$"+window.vis_config.nicemoneyaxis(a.toFixed())}).attr("class","legend_text").style("opacity","0").transition().duration(800).style("opacity","1"),e.append("svg:foreignObject").attr("height","100").attr("width","300").attr("y",k+b).attr("x","-20px").append("xhtml:body").style("padding-top","0px").style("background-color","transparent").html("<p style='color:black;'>Chinese Finance, 2000-2011<br><i>USD-2009</i> || <a style href='/projects'>See the Data</a></p>")},g=function(a,b){return d3.selectAll(".fuzz").transition().delay(a!=null?a:100).duration(b!=null?b:100).attr("filter","").each("end",function(){var a,b;return a=d3.select(this),b=map_data_item(this.id),(b!=null?b.values.value:void 0)>0?a.on("click",click).on("mouseover",c).on("mouseout",h).style("cursor","pointer"):a.on("click","").on("mouseover",d).on("mouseout",h).style("cursor","").transition().attr("fill","#777")})},h=function(){return d3.select(this).transition().attr("stroke",function(){return $(this).attr("name")&&$(this).attr("id")!=="non_african"?"#333":""}),$("#tooltip").hide(),$("#tooltiptext").text("")},d=function(){var a;return a=$(this).attr("name"),$("#tooltip").show(),$("#tooltiptext").html(""+a+"<br>No active projects")},c=function(){var a,b;return d3.select(this).transition().attr("stroke","#ddd"),a=this.id,b=$(this).attr("name"),$("#tooltip").show(),$("#tooltiptext").html(""+b+"<br>"+("Total: $"+window.vis_config.nicemoney(window.map_data_item(a).values.value)))},window.vis_config.gather_inputs=b,window.load_scope=function(a){var b;return $(".scope-button").removeClass("btn-success"),a.addClass("btn-success"),window.current_scope={name:a.attr("data-scope-name"),project_params:a.attr("data-project-params"),aggregate_params:a.attr("data-aggregate-params")},b="?get="+current_scope.aggregate_params,f(b)},window.load_this_scope=function(a){var b;return b=$(this),load_scope(b)},window.load_scope_by_name=function(a){var b;return b=$("#scope_"+a.replace(/\s/g,"_")),load_scope(b)},$(".vis_input").change(function(){var a;if(a=b())return window.active_params=a,f(a)}),$(document).mousemove(function(a){var b;return b={left:a.pageX,top:a.pageY},$("div#tooltip").css("left",b.left+10),$("div#tooltip").css("top",b.top-25)}),$(function(){return f(),load_scope_by_name("Official Finance")})})).call(this);