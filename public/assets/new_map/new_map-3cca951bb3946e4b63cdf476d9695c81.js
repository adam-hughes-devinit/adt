((function(){var a=[].slice;this.log=function(){var b,c,d,e,f;c=1<=arguments.length?a.call(arguments,0):[],f=[];for(d=0,e=c.length;d<e;d++)b=c[d],f.push(console.log(b));return f},this.App=this.App||{},App.map=L.map("map").setView([0,23],3),App.layers={},L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Map data &copy; OpenStreetMap contributors",maxZoom:18}).addTo(App.map),App.collection=new Miso.Dataset({url:"/javascripts/collection_latlong.json",extract:function(a){return a.features}}),App.collection.fetch({error:function(){return alert("couldn't fetch countries")},success:function(){var a;return a=L.geoJson(this.toJSON(),{style:{weight:1,color:"#aaaaaa",fillOpacity:.45,clickable:!0},onEachFeature:function(a,b){return App.layers[a.properties.id]=b,b.on({mouseover:function(a){b=a.target,b.setStyle({weight:2,fillOpacity:.7});if(!L.Browser.ie&&!L.Browser.opera)return b.bringToFront},mouseout:function(a){return b=a.target,b.setStyle({weight:1,fillOpacity:.45})},click:function(a){var b;return b=a.target.feature.properties.name,App.display_country(b),App.map.fitBounds(a.target.getBounds())}})}}),a.addTo(App.map)}}),App.data={full:new Miso.Dataset({url:"/aggregates/projects?get=recipient_iso2,recipient_name,crs_sector_name,year",columns:[{name:"recipient_iso2",type:"string"},{name:"recipient_name",type:"string"},{name:"year",type:"number"},{name:"crs_sector_name",type:"string"},{name:"usd_2009",type:"number",before:function(a){return a==null?0:a}},{name:"count",type:"number",before:function(a){return a==null?0:a}}]})},App.data.full.fetch({error:function(){return alert("couldn't load finance data.")},success:function(){var a,b,c;return App.data.by_country=App.data.full.groupBy("recipient_iso2",["usd_2009"]),a=App.data.by_country,c=a.max("usd_2009"),b=d3.scale.linear().domain([0,c/3,c]).range(["#FAEDD9","#808F12","#2A5C0B"]),a.each(function(a){var c;if(c=App.layers[a.recipient_iso2])return c.setStyle({color:b(a.usd_2009)})})}})})).call(this);