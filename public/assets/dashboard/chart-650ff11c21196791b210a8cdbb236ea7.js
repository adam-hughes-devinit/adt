((function(){var a,b,c,d,e=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};this.App=this.App||{},c=function(a,b){return $(this).attr("opacity",".6"),d(a)},a=function(a,b){return $(this).attr("opacity","1")},d=function(a){var b,c,d;return b=App.get_all_filters({all_if_none:!0}),c={},b.forEach(function(b){var d,e,f,g,h;h=b.values,e=b.key,g=function(){var a,b,c,f;c=App.config.data.columns,f=[];for(a=0,b=c.length;a<b;a++)d=c[a],d.name===e&&f.push(d);return f}()[0],g!=null&&(e===App.current_x_axis()?c[g.name]=g.now_showing.single(a.key):h.length>1?c[g.name]=g.now_showing.multiple(h):c[g.name]=g.now_showing.single(h[0])),f=function(){var a,b,c,e;c=App.config.data.columns,e=[];for(a=0,b=c.length;a<b;a++)d=c[a],d.name===App.current_y_axis()&&e.push(d);return e}()[0];if(f!=null)return c.measure=f.now_showing.value(a.value)}),d=App.config.now_showing(c),console.log("now_showing",c,"string: ",d),$("#detail").text(d)},b=function(a){var b,c,d,e;return $("#rescale").removeClass("btn-warning").addClass("btn-primary"),b=[0,d3.max(a.map(function(a){return a.value}))],c=App.config,App.amount_scale=d3.scale.linear().domain(b).range([c.vis_height-c.vis_padding_top-c.vis_padding_bottom,5]),d=d3.svg.axis().scale(App.amount_scale).orient("right").tickFormat(function(a){if(1e3>=a)return""+d3.format("0,r")(d3.round(a,0));if(1e6>a&&a>=1e3)return""+d3.round(a/1e3,0)+"K";if(1e9>a&&a>=1e6)return""+d3.round(a/1e6,1)+"M";if(a>=1e9)return""+d3.format("0,r")(d3.round(a/1e9,2))+"B"}).ticks(4),App.amount_color_scale=d3.scale.linear().domain([b[0],b[1]/2,b[1]*1.1]).range(["blue","purple","red"]),e=App.svg.selectAll(".y_axis").data([a]),e.enter().append("g").attr("class","y_axis").attr("transform","translate(10, "+c.vis_padding_top+")"),e.call(d)},App.render_dashboard=function(d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;o=(d!=null?d.rescale_y:void 0)||!1,$("#detail").html("<i>Mouseover for detail</i>"),console.log("Getting all filters"),k=App.get_all_filters(),j=App.projects.where(function(a,b){var c;return c=!0,k.forEach(function(d){var f;if(d.values.length>0&&!(f=a.get(d.key,b),e.call(d.values,f)>=0))return c=!1}),c}),console.log("filtering by ",k),t=App.current_x_axis(),console.log("x-axis:",t),q=j.query({dims:[t],vals:[dv.sum(App.current_y_axis())]}),console.log("starting to make sums"),l=q[0].map(function(a,b){return{key:a,value:q[1][b]}}),console.log("summing by",t,"returned",l),App.remove_blanks()||App.config.always_remove_blanks?n=function(){var a,b,c;c=[];for(a=0,b=l.length;a<b;a++)p=l[a],p.value>0&&c.push(p);return c}():(f=App.get_filter_values(t,{all_if_none:!0}),n=function(){var a,b,c,d;d=[];for(a=0,b=l.length;a<b;a++)p=l[a],(c=p.key,e.call(f,c)>=0)&&d.push(p);return d}()),console.log("about to make my domain:",n),i=_.sortBy(n,App.sort_order_function()).map(function(a){return a.key}),console.log("Making x axis by",t,"with these values",i),w=d3.scale.ordinal().domain(i).rangeBands([0,App.config.vis_width-App.config.vis_padding_left],.1),x=630/i.length,v=d3.svg.axis().scale(w).orient("bottom"),console.log("rendering this_x_axis to this_x_axis_svg"),u=App.svg.selectAll(".x_axis").data([t]),u.enter().append("g").attr("class","x_axis").attr("transform","translate("+App.config.vis_padding_left+", "+(App.config.vis_height-App.config.vis_padding_bottom)+")"),u.call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(a){return"rotate(-65)"});if(!App.amount_scale||o)console.log("Fetching a new y-scale"),b(n);console.log("binding and rendering new bars"),g=App.svg.selectAll(".bar").data(n,function(a){return a.key}),g.enter().append("rect").attr("class","bar").style("cursor","pointer"),g.exit().remove(),r=!1,s=!1,h=0,m=App.config.vis_height-App.config.vis_padding_top-App.config.vis_padding_bottom,g.transition().delay(function(a,b){return b*10}).attr("x",function(a,b){return""+(App.config.vis_padding_left+w(a.key))+"px"}).attr("y",function(a){return App.config.vis_padding_top+App.amount_scale(a.value)+"px"}).attr("width",x).attr("height",function(a){var b;return b=m-App.amount_scale(a.value),b>m&&(r=!0),b>h&&(h=b),b+"px"}).style("fill",function(a){return App.amount_color_scale(a.value)}),console.log("resizing according to calculated sizes"),h<m/2&&(s=!0),s?$("#rescale").removeClass("btn-primary").addClass("btn-warning"):$("#rescale").addClass("btn-primary").removeClass("btn-warning");if(r||App.config.always_rescale_to_fit)b(n),g.transition().delay(function(a,b){return b*20+250}).attr("y",function(a){return App.config.vis_padding_top+App.amount_scale(a.value)+"px"}).attr("height",function(a){var b;return b=m-App.amount_scale(a.value),b+"px"}).style("fill",function(a){return App.amount_color_scale(a.value)});return g.on("mouseover",c).on("mouseout",a).on("click",function(a,b){return App.show_overlay(a.key,{page:1})}),console.log("finished rendering!"),n}})).call(this);