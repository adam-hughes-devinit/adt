<% provide(:title, "Projects") %>
<% provide(:first_header, "View Projects") %>
<% current_url = "#{request.protocol}#{request.host_with_port}#{request.fullpath}".gsub(/\??page=\d+&*/, '') %>
<% joiner = current_url.index("?") ? "&" : "?" %>
<% def active_or_inactive(project)
	if !project.active 
		"<span class='inactive-project-title'>#{project.title} (Inactive)</span>".html_safe
	else
		project.title
	end
end %>
	



<div class="row" id='project-facets'>	
	<div class="span10">
		<%= form_tag projects_path, method: :get do %>

			<p> <b>Search: </b> 
				<%= text_field_tag :search, params[:search], class: "span7" %>
				<%= submit_tag "Submit", name: nil, class: "btn" %>
			</p>
		<% end %>
	</div>
	<div class='span10'>
		<p><b>Filters:</b></p>
	</div>
	<% first_half = (@facets.count/2).round %>
	<div class='span5'>
		<ol>
		<% @facets[0..first_half].each do |f| %>
			<%= render partial: 'facet_list', locals: {f: f, current_url: current_url, joiner: joiner} %>
		<% end %>
		</ol>
	</div>
	<div class='span5'>
		<ol>
		<% @facets[first_half+1..-1].each do |f| %>
			<%= render partial: 'facet_list', locals: {f: f, current_url: current_url, joiner: joiner} %>
		<% end %>
		</ol>
	</div>

</div>
<br>
<h3><%= @search.total %> Projects:</h3>

<%= will_paginate @projects %>
<table id="project-search-results">
	<thead>
		<tr>
			<th>Donor</th>
			<th>Title</th>
			<th>Year</th>
			<th>Recipients</th>
			<th>Amount (USD-2009)</th>
			<% if current_user %>
				<th>Links</th>
			<% end %>
		</tr>
	</thead>
	<tbody>
	    <% @projects.each do |p| %>
	    	<tr>
	    		<td><%= p.donor ? p.donor.name : 'Unset' %> </td>
	    		<td><%= link_to active_or_inactive(p), p %></td> 
	    		<td><%= p.year %></td>
	    		<td><%= p.country_name.join(', ') %></td>
	    		<td><%= p.usd_2009 %></td>
	    		<% if current_user && current_user.owner %>
		    		<td>
		    			<% if p.owner %>
	    					<% if p.owner == current_user.owner %>
	    						<%= link_to "Edit", edit_project_path(p) %>
	    					<% else %>
	    						Owner: <%= link_to p.owner.name, p.owner %> 
	    					<% end %>
	    				<% else %>
	    					No owner 
	    				<% end %>

	    			</td>
	    		<% end %>
	    	</tr>
	    <% end %>
	</tbody>
</table>
<%= will_paginate @projects %>
