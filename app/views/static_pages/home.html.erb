<% provide(:title, 'Home') %>
<script>
  $('body')
    .css('background-image', 'url("<%= image_path "gray_to_white.png" %>")')
</script>

<!-- Place in the <head>, after the three links -->
<script>
    // Can also be used with $(document).ready()
    $(window).load(function() {
        $('.flexslider').flexslider({
            animation: "slide"
        });
    });
</script>

<!-- Toggles banner when youtube video is played/paused.  -->
<script>
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var slide_1, slide_2, slide_3, slide_4, slide_5;
    // Creates youtube players for api to use.
    // The variables match the iframe id generated by embed_youtube.
    function onYouTubeIframeAPIReady() {
        slide_1 = new YT.Player('slide_1', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_2 = new YT.Player('slide_2', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_3 = new YT.Player('slide_3', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_4 = new YT.Player('slide_4', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_5 = new YT.Player('slide_5', {
            events: {
                'onStateChange': on_youtube_play
            }
        });

    }
    // Handle caption toggle.
    function on_youtube_play(event) {
        //console.log("state Change!", event)
        if (event.data == YT.PlayerState.PLAYING ) {
            //console.log("Youtube playing")
            $('.youtube-caption').slideToggle("slow");

        }
        else if (event.data == YT.PlayerState.PAUSED) {
            //console.log("Youtube paused"
            $('.youtube-caption').slideToggle("slow");

        }
    }

</script>

<style>
    .flexslider {
        width: 100%;
        height: 320px;
        border: 0 !important;
        margin-bottom: 2em !important;
    }
    .flexslider .frame {
        text-align: center;
        width: 100%;
        overflow:hidden;

    }
    .flexslider .frame  img {
        width:auto;
        height: 320px;
        max-width: 100%;
        max-height: 100%;
        display: inline-block;
    }

    .flex-direction-nav a:before  {
        font-family: "flexslider-icon";
        font-size: 40px;
        line-height: 40px;
        display: inline-block;
        content: '\f001';
    }

    .flex-caption {
        position:absolute;
        left:50;right:50;bottom:0;
        height:60px;
        background:rgba(0, 0, 0,0.6);
        z-index:1;
        width:7.14%;
        color: #FFFFFF;
        vertical-align: middle;
        padding-bottom: 10px;
        text-align: center;
    }

    .banner-text {
        display: inline-table;
        text-align: inherit;
        padding-left: 10px;

    }

    .banner-text h2 {
        color:#ffffff;
        font-size: 17px;
    }
    .banner-text h4 {
        color:#ffffff;
        font-size: 15px;

    }

    .banner-text a:link {
        color:#3BB9FF;
    }
    .banner-text a:visited {
        color:#3BB9FF;
    }
</style>


<div class='row-fluid' id='home_first_row' >
  <div class='span6'>

    <!--  Adds homepage items to media viewer -->
    <div class="flexslider">
      <ul class="slides">
        <% iframe_id = 1 %>
        <% @home_media.each do |home_media_item| %>
            <li>
              <div class="frame">
                <% if !home_media_item.url.blank? %>
                    <%= raw(home_media_item.youtube_embed(home_media_item.url,320,570,iframe_id)) %>
                <% else %>
                    <%= image_tag(home_media_item.home_media.url) %>
                <% end %>
                <div class="flex-caption youtube-caption" id=<%= iframe_id %>>
                  <p>
                      <div class="banner-text">
                         <h2><%= home_media_item.banner_title %></h2>
                         <h4><%= raw(home_media_item.banner_text) %></h4>
                      </div>
                  </p>
                </div>
                <% iframe_id = iframe_id +1 %>
              </div>
            </li>
        <% end %>

        <!-- Adds random media items from projects to media viewer -->
        <% if !@project_media.nil? %>
            <% @project_media.each do |media_item| %>
                <li>
                  <div class="frame">
                    <% if !media_item.url.blank? %>
                        <%= raw(media_item.youtube_embed(media_item.url,320,570,iframe_id)) %>
                    <% else %>
                        <%= image_tag media_item.media.url %>
                    <% end %>
                    <div class="flex-caption" >
                      <div class=banner-text>
                        <p>Learn more about <b><%= link_to media_item.homepage_text, project_path(media_item.project_id),{:style=>'color:#3BB9FF;'} %></b></p>
                      </div>
                    </div>
                    <% iframe_id = iframe_id +1 %>
                  </div>
                </li>
            <% end %>
        <% end %>
      </ul>
    </div>
  </div>
  <div id='stats-box' class='span6 container-fluid'>

    <div class='row-fluid'>
      <div class=''>
        <%= 
          render 'vital_stats' 
        %>
      </div>
    </div>
    <div class='row-fluid'>
      <div class=' alert alert-warning'>
        <%= render 'shared/recent'
         %>
      </div>
    </div>
  </div>
</div>

<div class='row-fluid' style="margin: 10px 0px 10px 0px;">
  <span class='span4'>
    <h4>
      <%= link_to "How to Use the Data", content_by_name_path("using_the_data"), class: "btn btn-large btn-info btn-block  home-button" %>
    </h4>
  </span>
  <span class='span4'>
    <h4>
      <%=link_to "Help us Improve the Data", content_by_name_path("improving_the_data"), class: "btn btn-large btn-block home-button" %>
    </h4>
  </span>
  <span class='span4'>
    <h4>
      <%=link_to "Coming Soon: Geocoded Data", content_by_name_path("geocoding"), class: "btn btn-large btn-warning btn-block home-button" %>
    </h4>
  </span>
</div>

<div class='row-fluid home_thumbnails'>
  <ul class='thumbnails '>
    <li class='span3'>
      <a href="<%= bubbles_path %>" class="thumbnail with_shadow">
        <h4>See the Big Picture &rarr;</h4>
        <%= image_tag("bubble_button.jpg", :alt => "Bubble Chart") %>
        
        
      </a>
    </li>
    <li class='span3'>
      <a href="<%= map_path %>" class="thumbnail with_shadow">
        <h4>Country-Level Perspective &rarr;</h4>
        <%= image_tag("map_button.png", :alt => "Map Overlay") %>
      </a>
    </li>
    <li class='span3' id='project_button' >
      <a href="<%= projects_path %>" class="thumbnail with_shadow">
        <h4>Project-Level Data &rarr;</h4>
        <%= image_tag("project_button_small.jpg", :alt => "Project Pages") %>
      </a>
    </li>
    <li class='span3'>
      <a href="<%= content_by_name_path("downloads") %>" class="thumbnail with_shadow">
        <h4>Download Data &rarr;</h4>
        <%= image_tag("aggregate_button.jpg", :alt => "Downloads") %>
      </a>
    </li>
  </ul>
</div>

<div class='row-fluid' id='home_media'>
  <div class='span12 row-fluid well'>
    <div class='span4'>
      <h3>
        In the News:
      </h3>
      <%= render 'latest_articles' %>
    </div>
    <div class='span4'>
      <h3>
        Recent Tweets:
      </h3>
      <%= render '/shared/twitter' %>
    </div>
    <div class='span4'>
      <h3>
        Publications:
      </h3>
      <%= render 'latest_publications' %>
    </div>
  </div>  
</div>
