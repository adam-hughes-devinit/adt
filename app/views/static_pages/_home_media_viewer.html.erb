<!-- Starts carousel sliding -->
<script type="text/javascript">
    $(document).ready(function() {
        $('.carousel').carousel({
            interval: 4000
        })
    });
    // Sets first item to active
    $(function() {
        $('#item_1').addClass('active');
    });

</script>

<!-- Toggles banner when youtube video is played/paused.  -->
<script>
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var slide_1, slide_2, slide_3, slide_4, slide_5;

    // Creates youtube players for api to use.
    // The variables match the iframe id generated by embed_youtube.
    function onYouTubeIframeAPIReady() {
        slide_1 = new YT.Player('slide_1', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_2 = new YT.Player('slide_2', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_3 = new YT.Player('slide_3', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_4 = new YT.Player('slide_4', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_5 = new YT.Player('slide_5', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
    }

    // Handle caption toggle.
    function on_youtube_play(event) {
        if (event.data == YT.PlayerState.PLAYING ) {
            $('.youtube-caption').slideToggle()
            $('#home_carousel').carousel('pause')
        }
        else if (event.data == YT.PlayerState.PAUSED) {
            $('.youtube-caption').slideToggle()
            $('#home_carousel').carousel('cycle')
        }
    }
</script>

<style>
    .carousel {
        width: 100%;
        height: 320px;
        border: 0 !important;
    }

    .carousel .item {
        text-align: center;
        width: 100%;
        overflow:hidden;
    }

    .carousel .item  img {
        width:auto;
        height: 320px;
        max-width: 100%;
        max-height: 100%;
        display: inline-block;
    }

    .carousel-caption {
        position:absolute;
        left:50;right:50;bottom:0;
        height:60px;
        z-index:1;
        width:100%;
        color: #FFFFFF;
        vertical-align: middle;
        padding-bottom: 10px;
        margin-left: -15px;
        text-align: center;
    }

    .carousel-indicators.middle {
        left: 0;
        right: 0;
        top: auto;
        bottom: 30px;
        text-align: right;
    }

    .carousel-indicators.middle li {
        float: none;
        display: inline-block;
    }

    .banner-text {
        display: inline-block;
        text-align: inherit;
        padding-left: 10px;
        padding-right: 10px;
    }

    .banner-text h2 {
        color:#ffffff;
        font-size: 17px;
    }

    .banner-text h4 {
        color:#ffffff;
        font-size: 15px;
    }

    .banner-text a:link {
        color:#3BB9FF;
    }
    .banner-text a:visited {
        color:#3BB9FF;
    }
</style>

<div id='home_carousel' class='carousel slide'>
  <div class='carousel-inner'>

    <!--  Adds homepage items to media viewer -->
    <% iframe_id = 1 %>
    <% @home_media.each do |home_media_item| %>
        <div class="item" id ="item_<%= iframe_id %>">
          <% if !home_media_item.url.blank? %>
              <%= raw(home_media_item.youtube_embed(home_media_item.url,320,570,iframe_id)) %>
          <% else %>
              <%= image_tag(home_media_item.home_media.url) %>
          <% end %>
          <div class="carousel-caption youtube-caption" id=<%= iframe_id %>>
            <p>
            <div class="banner-text">
              <h2><%= raw(home_media_item.banner_title) %></h2>
              <h4><%= raw(home_media_item.banner_text) %></h4>
            </div>
            </p>
          </div>
          <% iframe_id = iframe_id +1 %>
        </div>
    <% end %>

    <!-- Adds random media items from projects to media viewer -->
    <% if !@project_media.nil? %>
        <% @project_media.each do |media_item| %>

            <div class="item" id ="item_<%= iframe_id %>">
              <% if !media_item.url.blank? %>
                  <%= raw(media_item.youtube_embed(media_item.url,320,570,iframe_id)) %>
              <% else %>
                  <%= image_tag media_item.media.url %>
              <% end %>
              <div class="carousel-caption youtube-caption" id=<%= iframe_id %> >
                <p>
                <div class=banner-text>
                  <h2>Learn more about <%= link_to media_item.homepage_text, project_path(media_item.project_id),{:style=>'color:#3BB9FF;'} %></h2>
                </div>
                </p>
              </div>
              <% iframe_id = iframe_id +1 %>
            </div>
        <% end %>
    <% end %>
  </div>

  <a class='carousel-control left' href='#home_carousel' data-slide='prev'>&lsaquo;</a>
  <a class='carousel-control right' href='#home_carousel' data-slide='next'>&rsaquo;</a>

  <ol class='carousel-indicators middle'>
    <li data-target='#home_carousel' data-slide-to='0' class='active'></li>
    <li data-target='#home_carousel' data-slide-to='1'></li>
    <li data-target='#home_carousel' data-slide-to='2'></li>
    <li data-target='#home_carousel' data-slide-to='3'></li>
    <li data-target='#home_carousel' data-slide-to='4'></li>
  </ol>
</div>