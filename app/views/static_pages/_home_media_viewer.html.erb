<!-- Place in the <head>, after the three links -->
<script>
    // Can also be used with $(document).ready()
    // Javascript for file viewer
    $(window).load(function() {
        $('.flexslider').flexslider({
            animation: "fade",   //options:"slide" or "fade"
            controlNav:true,
            directionNav:true,
            easing:false,
            animationSpeed:400,
            pauseOnAction: true,
            pauseOnHover: true,
            useCSS: true  // turn off for slide to work in firefox.
        });
    });

</script>

<!-- Toggles banner when youtube video is played/paused.  -->
<script>
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var slide_1, slide_2, slide_3, slide_4, slide_5;
    // Creates youtube players for api to use.
    // The variables match the iframe id generated by embed_youtube.
    function onYouTubeIframeAPIReady() {
        slide_1 = new YT.Player('slide_1', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_2 = new YT.Player('slide_2', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_3 = new YT.Player('slide_3', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_4 = new YT.Player('slide_4', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_5 = new YT.Player('slide_5', {
            events: {
                'onStateChange': on_youtube_play

            }
        });

    }
    // Handle caption toggle.
    function on_youtube_play(event) {
        //console.log("state Change!", event)
        if (event.data == YT.PlayerState.PLAYING ) {
            //console.log("Youtube playing")
            $('.youtube-caption').slideToggle("slow");
            $('.flexslider').flexslider("pause"); // not working

        }
        else if (event.data == YT.PlayerState.PAUSED) {
            //console.log("Youtube paused"
            $('.youtube-caption').slideToggle("slow");
            $('.flexslider').flexslider("play"); // not working

        }
    }

</script>

<style>
    .flexslider {
        width: 100%;
        height: 320px;
        border: 0 !important;
        margin-bottom: 2em !important;
    }
    .flexslider .frame {
        text-align: center;
        width: 100%;
        overflow:hidden;

    }
    .flexslider .frame  img {
        width:auto;
        height: 320px;
        max-width: 100%;
        max-height: 100%;
        display: inline-block;
    }

    .flex-direction-nav a  {
        font-family: "flexslider-icon";
        font-size: 40px;
        line-height: 40px;
        display: inline-block;
        content: '\f001';
    }

    .flex-caption {
        position:absolute;
        left:50;right:50;bottom:0;
        height:60px;
        background:rgba(0, 0, 0,0.6);
        z-index:1;
        width:100%;
        color: #FFFFFF;
        vertical-align: middle;
        padding-bottom: 10px;
        text-align: center;
    }

    .banner-text {
        display: inline-table;
        text-align: inherit;
        padding-left: 10px;
        padding-right: 10px

    }

    .banner-text h2 {
        color:#ffffff;
        font-size: 17px;
    }
    .banner-text h4 {
        color:#ffffff;
        font-size: 15px;

    }

    .banner-text a:link {
        color:#3BB9FF;
    }
    .banner-text a:visited {
        color:#3BB9FF;
    }
</style>

<!--  Adds homepage items to media viewer -->
<div class="flexslider">
  <ul class="slides">
    <% iframe_id = 1 %>
    <% @home_media.each do |home_media_item| %>
        <li>
          <div class="frame">
            <% if !home_media_item.url.blank? %>
                <%= raw(home_media_item.youtube_embed(home_media_item.url,320,570,iframe_id)) %>
            <% else %>
                <%= image_tag(home_media_item.home_media.url) %>
            <% end %>
            <div class="flex-caption youtube-caption" id=<%= iframe_id %>>
              <p>
              <div class="banner-text">
                <h2><%= home_media_item.banner_title %></h2>
                <h4><%= raw(home_media_item.banner_text) %></h4>
              </div>
              </p>
            </div>
            <% iframe_id = iframe_id +1 %>
          </div>
        </li>
    <% end %>

    <!-- Adds random media items from projects to media viewer -->
    <% if !@project_media.nil? %>
        <% @project_media.each do |media_item| %>
            <li>
              <div class="frame">
                <% if !media_item.url.blank? %>
                    <%= raw(media_item.youtube_embed(media_item.url,320,570,iframe_id)) %>
                <% else %>
                    <%= image_tag media_item.media.url %>
                <% end %>
                <div class="flex-caption youtube-caption" id=<%= iframe_id %> >
                  <p>
                  <div class=banner-text>
                    <h2>Learn more about <%= link_to media_item.homepage_text, project_path(media_item.project_id),{:style=>'color:#3BB9FF;'} %></h2>
                  </div>
                  </p>
                </div>
                <% iframe_id = iframe_id +1 %>
              </div>
            </li>
        <% end %>
    <% end %>
  </ul>
</div>