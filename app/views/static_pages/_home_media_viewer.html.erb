<!-- Starts carousel sliding -->
<script type="text/javascript">
    $(document).ready(function() {
        $('.carousel').carousel({
            interval: 4000
        })
    });
</script>

<!-- Toggles banner when youtube video is played/paused.  -->
<script>
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var slide_1, slide_2, slide_3, slide_4, slide_5;
    // Creates youtube players for api to use.
    // The variables match the iframe id generated by embed_youtube.
    function onYouTubeIframeAPIReady() {
        slide_1 = new YT.Player('slide_1', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_2 = new YT.Player('slide_2', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_3 = new YT.Player('slide_3', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_4 = new YT.Player('slide_4', {
            events: {
                'onStateChange': on_youtube_play
            }
        });
        slide_5 = new YT.Player('slide_5', {
            events: {
                'onStateChange': on_youtube_play

            }
        });

    }
    // Handle caption toggle.
    function on_youtube_play(event) {
        //console.log("state Change!", event)
        if (event.data == YT.PlayerState.PLAYING ) {
            //console.log("Youtube playing")
            $('.youtube-caption').slideToggle()
            $('#home_carousel').carousel('pause')
        }
        else if (event.data == YT.PlayerState.PAUSED) {
            //console.log("Youtube paused")
            $('.youtube-caption').slideToggle()
            $('#home_carousel').carousel('cycle')
        }
    }

</script>


<style>
    .banner-text {
        display: inline-table;
        text-align: inherit;
        padding-left: 10px;
        padding-right: 10px

    }

    .banner-text h2 {
        color:#ffffff;
        font-size: 17px;
    }
    .banner-text h4 {
        color:#ffffff;
        font-size: 15px;

    }

    .banner-text a:link {
        color:#3BB9FF;
    }
    .banner-text a:visited {
        color:#3BB9FF;
    }

    .carousel.carousel-fade .item {
        -webkit-transition: opacity 0.5s ease-in-out;
        -moz-transition: opacity 0.5s ease-in-out;
        -ms-transition: opacity 0.5s ease-in-out;
        -o-transition: opacity 0.5s ease-in-out;
        transition: opacity 0.5s ease-in-out;
        opacity:0;
    }

    .carousel.carousel-fade .active.item {
        opacity:1;
    }

    .carousel.carousel-fade .active.left,
    .carousel.carousel-fade .active.right {
        left: 0;
        z-index: 2;
        opacity: 0;
        filter: alpha(opacity=0);
    }

    .carousel.carousel-fade .next,
    .carousel.carousel-fade .prev {
        left: 0;
        z-index: 1;
    }

    .carousel.carousel-fade .carousel-control {
        z-index: 3;
    }
</style>



<div id='home_carousel' class='carousel slide carousel-fade'>
  <ol class='carousel-indicators'>
    <li data-target='#home_carousel' data-slide-to='0' class='active'></li>
    <li data-target='#home_carousel' data-slide-to='1'></li>
    <li data-target='#home_carousel' data-slide-to='2'></li>
    <li data-target='#home_carousel' data-slide-to='3'></li>
    <li data-target='#home_carousel' data-slide-to='4'></li>
  </ol>

  <div class='carousel-inner'>

    <!--  Adds homepage items to media viewer -->
    <% iframe_id = 1 %>
    <% active = "active" %>
    <% @home_media.each do |home_media_item| %>
        <div class="<%= active %> item">
          <% if !home_media_item.url.blank? %>
              <%= raw(home_media_item.youtube_embed(home_media_item.url,320,570,iframe_id)) %>
          <% else %>
              <%= image_tag(home_media_item.home_media.url) %>
          <% end %>
          <div class="carousel-caption youtube-caption" id=<%= iframe_id %>>
            <p>
            <div class="banner-text">
              <h2><%= home_media_item.banner_title %></h2>
              <h4><%= raw(home_media_item.banner_text) %></h4>
            </div>
            </p>
          </div>
          <% iframe_id = iframe_id +1 %>
          <% active = "" %>
        </div>
    <% end %>


    <!-- Adds random media items from projects to media viewer -->
    <% if !@project_media.nil? %>
        <% @project_media.each do |media_item| %>

            <div class="<%= active %> item">
              <% if !media_item.url.blank? %>
                  <%= raw(media_item.youtube_embed(media_item.url,320,570,iframe_id)) %>
              <% else %>
                  <%= image_tag media_item.media.url %>
              <% end %>
              <div class="carousel-caption youtube-caption" id=<%= iframe_id %> >
                <p>
                <div class=banner-text>
                  <h2>Learn more about <%= link_to media_item.homepage_text, project_path(media_item.project_id),{:style=>'color:#3BB9FF;'} %></h2>
                </div>
                </p>
              </div>
              <% iframe_id = iframe_id +1 %>
              <% active = "" %>
            </div>

        <% end %>
    <% end %>


  </div>
  <a class='carousel-control left' href='#home_carousel' data-slide='prev'>&lsaquo;</a>
  <a class='carousel-control right' href='#home_carousel' data-slide='next'>&rsaquo;</a>
</div>
